<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.52" />
  <meta name="author" content="Akhilesh Reddy">

  
  
  
  
    
      
    
  
  <meta name="description" content="from datetime import * from gmplot import gmplot import pandas as pd %pylab inline import matplotlib.pyplot as plt import seaborn as sns from matplotlib.pyplot import figure  Populating the interactive namespace from numpy and matplotlib C:\Users\Akhil\Anaconda2\lib\site-packages\IPython\core\magics\pylab.py:161: UserWarning: pylab import has clobbered these variables: [&#39;datetime&#39;, &#39;time&#39;] `%matplotlib` prevents importing * from pylab and numpy &quot;\n`%matplotlib` prevents importing * from pylab and numpy&quot;  train = pd.DataFrame({&#39;id&#39;:[1,2,4],&#39;features&#39;:[[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;],[&quot;A&quot;,&quot;D&quot;,&quot;E&quot;],[&quot;C&quot;,&quot;D&quot;,&quot;F&quot;]]})  train[&#39;features_t&#39;] = train[&quot;features&quot;].apply(lambda x: &quot; &quot;.">

  
  <link rel="alternate" hreflang="en-us" href="https://akhilesh-reddy.github.io/post/eda_henry-edited-akhil/">

  


  

  
  
  <meta name="theme-color" content="#4caf50">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="https://akhilesh-reddy.github.io/index.xml" type="application/rss+xml" title="Akhilesh Reddy">
  <link rel="feed" href="https://akhilesh-reddy.github.io/index.xml" type="application/rss+xml" title="Akhilesh Reddy">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://akhilesh-reddy.github.io/post/eda_henry-edited-akhil/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@https://twitter.com/akhileshreddy44">
  <meta property="twitter:creator" content="@https://twitter.com/akhileshreddy44">
  
  <meta property="og:site_name" content="Akhilesh Reddy">
  <meta property="og:url" content="https://akhilesh-reddy.github.io/post/eda_henry-edited-akhil/">
  <meta property="og:title" content=" | Akhilesh Reddy">
  <meta property="og:description" content="from datetime import * from gmplot import gmplot import pandas as pd %pylab inline import matplotlib.pyplot as plt import seaborn as sns from matplotlib.pyplot import figure  Populating the interactive namespace from numpy and matplotlib C:\Users\Akhil\Anaconda2\lib\site-packages\IPython\core\magics\pylab.py:161: UserWarning: pylab import has clobbered these variables: [&#39;datetime&#39;, &#39;time&#39;] `%matplotlib` prevents importing * from pylab and numpy &quot;\n`%matplotlib` prevents importing * from pylab and numpy&quot;  train = pd.DataFrame({&#39;id&#39;:[1,2,4],&#39;features&#39;:[[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;],[&quot;A&quot;,&quot;D&quot;,&quot;E&quot;],[&quot;C&quot;,&quot;D&quot;,&quot;F&quot;]]})  train[&#39;features_t&#39;] = train[&quot;features&quot;].apply(lambda x: &quot; &quot;.">
  <meta property="og:locale" content="en-us">
  
  
  
  

  

  <title> | Akhilesh Reddy</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Akhilesh Reddy</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/docs/resume.pdf">
            
            <span>Resume</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name"></h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      Jan 1, 0001
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Akhilesh Reddy">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    13 min read
  </span>
  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=&amp;url=https%3a%2f%2fakhilesh-reddy.github.io%2fpost%2feda_henry-edited-akhil%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fakhilesh-reddy.github.io%2fpost%2feda_henry-edited-akhil%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fakhilesh-reddy.github.io%2fpost%2feda_henry-edited-akhil%2f&amp;title="
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2fakhilesh-reddy.github.io%2fpost%2feda_henry-edited-akhil%2f&amp;title="
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=&amp;body=https%3a%2f%2fakhilesh-reddy.github.io%2fpost%2feda_henry-edited-akhil%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      

<pre><code class="language-python">from datetime import *
from gmplot import gmplot
import pandas as pd
%pylab inline
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib.pyplot import figure
</code></pre>

<pre><code>Populating the interactive namespace from numpy and matplotlib


C:\Users\Akhil\Anaconda2\lib\site-packages\IPython\core\magics\pylab.py:161: UserWarning: pylab import has clobbered these variables: ['datetime', 'time']
`%matplotlib` prevents importing * from pylab and numpy
  &quot;\n`%matplotlib` prevents importing * from pylab and numpy&quot;
</code></pre>

<pre><code class="language-python">train  = pd.DataFrame({'id':[1,2,4],'features':[[&quot;A&quot;,&quot;B&quot;,&quot;C&quot;],[&quot;A&quot;,&quot;D&quot;,&quot;E&quot;],[&quot;C&quot;,&quot;D&quot;,&quot;F&quot;]]})
</code></pre>

<pre><code class="language-python">train['features_t'] = train[&quot;features&quot;].apply(lambda x: &quot; &quot;.join([&quot;_&quot;.join(i.split(&quot; &quot;)) for i in x]))
</code></pre>

<pre><code class="language-python">for i in train['features'][:1]:
    print(i)
</code></pre>

<pre><code>['A', 'B', 'C']
</code></pre>

<pre><code class="language-python">train['features'][:1]
</code></pre>

<pre><code>0    [A, B, C]
Name: features, dtype: object
</code></pre>

<h1 id="print-train-features-t">print train[&lsquo;features_t&rsquo;]</h1>

<p>train</p>

<pre><code class="language-python">#read dataset and take a look
stations = pd.read_csv(&quot;austin_bikeshare_stations.csv&quot;)
trip = pd.read_csv(&quot;austin_bikeshare_trips.csv&quot;)
trip = trip.dropna()
trip['year'] = trip['year'].apply(lambda x : str(int(x)))
trips = trip[trip['year'].isin(['2014','2015','2016'])]


# trips = trip[trip['year'] &gt;='2014.0' &amp; trip['year'] &lt;='2016.0']
</code></pre>

<pre><code class="language-python">def plot_lines(df, subplots, title, xlabel, ylabel):
    '''Generates one or more line plots from pandas dataframe'''
    
    fig, ax = subplots
    ax = df.plot.line(ax=ax)
    ax.set_xlabel(xlabel, fontdict={'size' : 14})
    ax.set_ylabel(ylabel, fontdict={'size' : 14})
    ax.set_title(title, fontdict={'size' : 18}) 
    ttl = ax.title
    ttl.set_position([.5, 1.02])
    ax.tick_params(axis='x', labelsize=14)
    ax.tick_params(axis='y', labelsize=14)
</code></pre>

<pre><code class="language-python">#transfer time into datetime
# trips[&quot;start_time&quot;] = trips[&quot;start_time&quot;].map(lambda x : datetime.datetime.strptime(x, &quot;%Y-%m-%d %H:%M:%S&quot;))

trips = trips.set_index('start_time')
# trips[:10]

trips_ts = trips.resample('W').size()
trips_ts[:10]
plt.rcParams['figure.figsize'] = [10, 5]
plt.plot(trips_ts, color='g')
plt.xlabel('Weeks')
plt.ylabel('Number of rides')
plt.title('Weekly Rentals')
savefig(&quot;Weekly Rentals.PNG&quot;)

# plot_lines(trips.resample('W').size(), plt.subplots(1,1, figsize=(20,8)), 
#            title='Weekly rentals', xlabel='', ylabel='Weekly rentals')

# There are different ways to plot this
# # trips[&quot;hours&quot;] = trips[&quot;start_time&quot;].map(lambda x : x.hour)
</code></pre>

<p><img src="output_8_0.png" alt="png" /></p>

<pre><code class="language-python">#check earliest and  of this dataset
print max(trips[&quot;start_time&quot;] ), min(trips[&quot;start_time&quot;] )
</code></pre>

<pre><code>2017-07-31 23:44:27 2013-12-21 09:12:00
</code></pre>

<pre><code class="language-python">def clean_memberships(df, col):
    '''Cleans memberships by consolidating and converting to categories
    INPUT: df - pandas Dataframe containing membership columns
           col - column name to be consolidated
    RETURNS: pandas DataFrame with consolidated memberships'''
    
    # Replace the various memberships with their groupings
    df[col] = df[col].astype(str)
    df[col] = df[col].replace(['RideScout Single Ride','Try Before You Buy Special'], value='single')
    df[col] = df[col].replace(['^24-Hour.*$', '^Explorer.*$', '^Walk Up$'], value='day', regex=True)
    df[col] = df[col].replace(['^ACL Weekend Pass.*$', '^FunFunFun.*$', '^Weekender.*$'], value='weekend', regex=True)
    df[col] = df[col].replace(['^7-Day.*$'], value='week', regex=True)
    df[col] = df[col].replace(['^Local30.*$'], value='month', regex=True)
    df[col] = df[col].replace(['^Semester.*$'], value='semester', regex=True)
    df[col] = df[col].replace(['^Annual.*$', '^Local365.*$', 'Republic Rider.*$', '^Membership: pay once  one-year.*$'], value='year', regex=True)
    df[col] = df[col].replace(['^Founding Member.*$', '^.*Founder.*$'], value='triannual', regex=True)

    # Drop the remaining trips (PROHIBITED and RESTRICTED)
    drop_mask = (df['subscriber_type'] == 'PROHIBITED') | (df['subscriber_type'] == 'RESTRICTED')
    df = df[~drop_mask]
    
    # Finally convert to categorical
    df[col] = df[col].astype('category')
    return df
    
trips = clean_memberships(trips, 'subscriber_type')
</code></pre>

<pre><code>C:\Users\Akhil\Anaconda2\lib\site-packages\ipykernel_launcher.py:23: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
</code></pre>

<pre><code class="language-python">trips[:10]
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bikeid</th>
      <th>checkout_time</th>
      <th>duration_minutes</th>
      <th>end_station_id</th>
      <th>end_station_name</th>
      <th>month</th>
      <th>start_station_id</th>
      <th>start_station_name</th>
      <th>subscriber_type</th>
      <th>trip_id</th>
      <th>year</th>
    </tr>
    <tr>
      <th>start_time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-03-19 19:12:00</th>
      <td>8.0</td>
      <td>19:12:00</td>
      <td>41</td>
      <td>2565.0</td>
      <td>Trinity &amp; 6th Street</td>
      <td>3.0</td>
      <td>2536.0</td>
      <td>Waller &amp; 6th St.</td>
      <td>day</td>
      <td>9900082882</td>
      <td>2015.0</td>
    </tr>
    <tr>
      <th>2016-10-30 02:06:04</th>
      <td>141.0</td>
      <td>2:06:04</td>
      <td>6</td>
      <td>2570.0</td>
      <td>South Congress &amp; Academy</td>
      <td>10.0</td>
      <td>2494.0</td>
      <td>2nd &amp; Congress</td>
      <td>year</td>
      <td>12617682</td>
      <td>2016.0</td>
    </tr>
    <tr>
      <th>2016-03-11 16:28:27</th>
      <td>578.0</td>
      <td>16:28:27</td>
      <td>13</td>
      <td>2498.0</td>
      <td>Convention Center / 4th St. @ MetroRail</td>
      <td>3.0</td>
      <td>2538.0</td>
      <td>Bullock Museum @ Congress &amp; MLK</td>
      <td>year</td>
      <td>9075366</td>
      <td>2016.0</td>
    </tr>
    <tr>
      <th>2014-11-23 15:12:00</th>
      <td>555.0</td>
      <td>15:12:00</td>
      <td>80</td>
      <td>2712.0</td>
      <td>Toomey Rd @ South Lamar</td>
      <td>11.0</td>
      <td>2497.0</td>
      <td>Capitol Station / Congress &amp; 11th</td>
      <td>day</td>
      <td>9900319298</td>
      <td>2014.0</td>
    </tr>
    <tr>
      <th>2017-04-16 15:39:13</th>
      <td>86.0</td>
      <td>15:39:13</td>
      <td>25</td>
      <td>3377.0</td>
      <td>MoPac Pedestrian Bridge @ Veterans Drive</td>
      <td>4.0</td>
      <td>2707.0</td>
      <td>Rainey St @ Cummings</td>
      <td>day</td>
      <td>14468597</td>
      <td>2017.0</td>
    </tr>
    <tr>
      <th>2015-05-29 15:12:00</th>
      <td>861.0</td>
      <td>15:12:00</td>
      <td>29</td>
      <td>2537.0</td>
      <td>West &amp; 6th St.</td>
      <td>5.0</td>
      <td>2540.0</td>
      <td>17th &amp; Guadalupe</td>
      <td>month</td>
      <td>9900153369</td>
      <td>2015.0</td>
    </tr>
    <tr>
      <th>2016-07-26 12:24:16</th>
      <td>382.0</td>
      <td>12:24:16</td>
      <td>17</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>7.0</td>
      <td>2567.0</td>
      <td>Palmer Auditorium</td>
      <td>day</td>
      <td>11114967</td>
      <td>2016.0</td>
    </tr>
    <tr>
      <th>2015-01-15 13:12:00</th>
      <td>435.0</td>
      <td>13:12:00</td>
      <td>49</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>1.0</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>day</td>
      <td>9900005413</td>
      <td>2015.0</td>
    </tr>
    <tr>
      <th>2014-05-05 13:12:00</th>
      <td>555.0</td>
      <td>13:12:00</td>
      <td>19</td>
      <td>2571.0</td>
      <td>Red River &amp; 8th Street</td>
      <td>5.0</td>
      <td>2503.0</td>
      <td>South Congress &amp; James</td>
      <td>day</td>
      <td>9900126917</td>
      <td>2014.0</td>
    </tr>
    <tr>
      <th>2017-07-08 12:27:28</th>
      <td>668.0</td>
      <td>12:27:28</td>
      <td>20</td>
      <td>3377.0</td>
      <td>MoPac Pedestrian Bridge @ Veterans Drive</td>
      <td>NaN</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>day</td>
      <td>15339050</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">
# Show histogram of trip duration by membership type# Show  
# g = sns.FacetGrid(trip_df, row='membership', sharey=False, sharex=False, margin_titles=True, size=4)
# g.map(plt.hist, 'duration')

membership_order = ['single', 'day', 'weekend', 'week', 'month', 'semester', 'year', 'triannual']

def plot_boxplot(df, order, x, y, figsize, title, xlabel, ylabel):
    '''Plots a boxplot using given '''
    fig, ax = plt.subplots(1,1, figsize=figsize)  
    ax = sns.boxplot(data=df, x=x, y=y, order=order)
    ax.set_xlabel(xlabel, fontdict={'size' : 14})
    ax.set_ylabel(ylabel, fontdict={'size' : 14})
    ax.set_title(title, fontdict={'size' : 18})
    ax.tick_params(axis='x', labelsize=14)
    ax.tick_params(axis='y', labelsize=14)
    ttl = ax.title
    ttl.set_position([.5, 1.02])

# Log-transform the durations to compress range
trips['log_duration'] = trips['duration_minutes'].apply(np.log10)
# sns.boxplot(data=trips, x='subscriber_type', y='duration_minutes')
plot_boxplot(trips, order=membership_order, x='subscriber_type', y='log_duration', figsize=(20,10),
            title='Trip duration by membership type', xlabel='Membership', ylabel='Trip duration (log10 minutes)')
</code></pre>

<p><img src="output_12_0.png" alt="png" /></p>

<pre><code class="language-python">plot_df = trips.copy()
plot_df['year'] = plot_df.index.year
plot_df = plot_df['2014-01-01':'2016-12-31'].groupby(['year', 'subscriber_type']).size().reset_index(name='count')
plot_df = plot_df.pivot_table(index='year', columns='subscriber_type', values='count')
plot_df = plot_df.fillna(0)

def plot_bar(df, size, title, xlabel, ylabel):
    '''Plots a bar graph of the dataframe '''
    
    palette = sns.color_palette('Set2', len(df.columns)) # Don't repeat colours
    fig, ax = plt.subplots(1, 1, figsize=size)
    ax = df.plot.bar(ax=ax, color=palette, rot=0)
    ax.set_xlabel(xlabel, fontdict={'size' : 14})
    ax.set_ylabel(ylabel, fontdict={'size' : 14})
    ax.set_title(title, fontdict={'size' : 18}) 
    ttl = ax.title
    ttl.set_position([.5, 1.02])
    ax.tick_params(axis='x', labelsize=14)
    ax.tick_params(axis='y', labelsize=14)   
    ax.legend(fontsize = 14)

plot_bar(plot_df, (20,10), title='Trips by membership type and year', xlabel='Year', ylabel='Trip count')
</code></pre>

<p><img src="output_13_0.png" alt="png" /></p>

<pre><code class="language-python">plot_df[:15]
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bikeid</th>
      <th>checkout_time</th>
      <th>duration_minutes</th>
      <th>end_station_id</th>
      <th>end_station_name</th>
      <th>month</th>
      <th>start_station_id</th>
      <th>start_station_name</th>
      <th>subscriber_type</th>
      <th>trip_id</th>
      <th>year</th>
      <th>log_duration</th>
    </tr>
    <tr>
      <th>start_time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-03-19 19:12:00</th>
      <td>8.0</td>
      <td>19:12:00</td>
      <td>41</td>
      <td>2565.0</td>
      <td>Trinity &amp; 6th Street</td>
      <td>3.0</td>
      <td>2536.0</td>
      <td>Waller &amp; 6th St.</td>
      <td>day</td>
      <td>9900082882</td>
      <td>2015</td>
      <td>1.612784</td>
    </tr>
    <tr>
      <th>2016-10-30 02:06:04</th>
      <td>141.0</td>
      <td>2:06:04</td>
      <td>6</td>
      <td>2570.0</td>
      <td>South Congress &amp; Academy</td>
      <td>10.0</td>
      <td>2494.0</td>
      <td>2nd &amp; Congress</td>
      <td>year</td>
      <td>12617682</td>
      <td>2016</td>
      <td>0.778151</td>
    </tr>
    <tr>
      <th>2016-03-11 16:28:27</th>
      <td>578.0</td>
      <td>16:28:27</td>
      <td>13</td>
      <td>2498.0</td>
      <td>Convention Center / 4th St. @ MetroRail</td>
      <td>3.0</td>
      <td>2538.0</td>
      <td>Bullock Museum @ Congress &amp; MLK</td>
      <td>year</td>
      <td>9075366</td>
      <td>2016</td>
      <td>1.113943</td>
    </tr>
    <tr>
      <th>2014-11-23 15:12:00</th>
      <td>555.0</td>
      <td>15:12:00</td>
      <td>80</td>
      <td>2712.0</td>
      <td>Toomey Rd @ South Lamar</td>
      <td>11.0</td>
      <td>2497.0</td>
      <td>Capitol Station / Congress &amp; 11th</td>
      <td>day</td>
      <td>9900319298</td>
      <td>2014</td>
      <td>1.903090</td>
    </tr>
    <tr>
      <th>2017-04-16 15:39:13</th>
      <td>86.0</td>
      <td>15:39:13</td>
      <td>25</td>
      <td>3377.0</td>
      <td>MoPac Pedestrian Bridge @ Veterans Drive</td>
      <td>4.0</td>
      <td>2707.0</td>
      <td>Rainey St @ Cummings</td>
      <td>day</td>
      <td>14468597</td>
      <td>2017</td>
      <td>1.397940</td>
    </tr>
    <tr>
      <th>2015-05-29 15:12:00</th>
      <td>861.0</td>
      <td>15:12:00</td>
      <td>29</td>
      <td>2537.0</td>
      <td>West &amp; 6th St.</td>
      <td>5.0</td>
      <td>2540.0</td>
      <td>17th &amp; Guadalupe</td>
      <td>month</td>
      <td>9900153369</td>
      <td>2015</td>
      <td>1.462398</td>
    </tr>
    <tr>
      <th>2016-07-26 12:24:16</th>
      <td>382.0</td>
      <td>12:24:16</td>
      <td>17</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>7.0</td>
      <td>2567.0</td>
      <td>Palmer Auditorium</td>
      <td>day</td>
      <td>11114967</td>
      <td>2016</td>
      <td>1.230449</td>
    </tr>
    <tr>
      <th>2015-01-15 13:12:00</th>
      <td>435.0</td>
      <td>13:12:00</td>
      <td>49</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>1.0</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>day</td>
      <td>9900005413</td>
      <td>2015</td>
      <td>1.690196</td>
    </tr>
    <tr>
      <th>2014-05-05 13:12:00</th>
      <td>555.0</td>
      <td>13:12:00</td>
      <td>19</td>
      <td>2571.0</td>
      <td>Red River &amp; 8th Street</td>
      <td>5.0</td>
      <td>2503.0</td>
      <td>South Congress &amp; James</td>
      <td>day</td>
      <td>9900126917</td>
      <td>2014</td>
      <td>1.278754</td>
    </tr>
    <tr>
      <th>2017-07-08 12:27:28</th>
      <td>668.0</td>
      <td>12:27:28</td>
      <td>20</td>
      <td>3377.0</td>
      <td>MoPac Pedestrian Bridge @ Veterans Drive</td>
      <td>NaN</td>
      <td>2575.0</td>
      <td>Riverside @ S. Lamar</td>
      <td>day</td>
      <td>15339050</td>
      <td>2017</td>
      <td>1.301030</td>
    </tr>
    <tr>
      <th>2014-03-14 20:12:00</th>
      <td>981.0</td>
      <td>20:12:00</td>
      <td>44</td>
      <td>2565.0</td>
      <td>Trinity &amp; 6th Street</td>
      <td>3.0</td>
      <td>2563.0</td>
      <td>Davis at Rainey Street</td>
      <td>day</td>
      <td>9900051787</td>
      <td>2014</td>
      <td>1.643453</td>
    </tr>
    <tr>
      <th>2016-09-03 22:57:45</th>
      <td>95.0</td>
      <td>22:57:45</td>
      <td>12</td>
      <td>2537.0</td>
      <td>West &amp; 6th St.</td>
      <td>9.0</td>
      <td>2565.0</td>
      <td>Trinity &amp; 6th Street</td>
      <td>day</td>
      <td>11744697</td>
      <td>2016</td>
      <td>1.079181</td>
    </tr>
    <tr>
      <th>2016-10-08 13:20:32</th>
      <td>518.0</td>
      <td>13:20:32</td>
      <td>21</td>
      <td>1006.0</td>
      <td>Zilker Park West</td>
      <td>10.0</td>
      <td>2565.0</td>
      <td>Trinity &amp; 6th Street</td>
      <td>day</td>
      <td>12298359</td>
      <td>2016</td>
      <td>1.322219</td>
    </tr>
    <tr>
      <th>2017-03-15 22:24:42</th>
      <td>188.0</td>
      <td>22:24:42</td>
      <td>14</td>
      <td>2544.0</td>
      <td>East 6th &amp; Pedernales St.</td>
      <td>3.0</td>
      <td>2571.0</td>
      <td>Red River &amp; 8th Street</td>
      <td>month</td>
      <td>14054290</td>
      <td>2017</td>
      <td>1.146128</td>
    </tr>
    <tr>
      <th>2017-04-07 16:15:51</th>
      <td>386.0</td>
      <td>16:15:51</td>
      <td>13</td>
      <td>2566.0</td>
      <td>Pfluger Bridge @ W 2nd Street</td>
      <td>4.0</td>
      <td>2572.0</td>
      <td>Barton Springs Pool</td>
      <td>year</td>
      <td>14348890</td>
      <td>2017</td>
      <td>1.113943</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">(trips[&quot;end_station_name&quot;].value_counts()[:20]/sum(trips[&quot;end_station_name&quot;].value_counts())).plot(kind = &quot;bar&quot;)
</code></pre>

<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x16a4a4a8&gt;
</code></pre>

<p><img src="output_15_1.png" alt="png" /></p>

<pre><code class="language-python">#summary statistics
trips[[&quot;duration_minutes&quot;, &quot;hours&quot;, &quot;month&quot;,&quot;year&quot;]].describe()
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>duration_minutes</th>
      <th>hours</th>
      <th>month</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>649231.000000</td>
      <td>649231.000000</td>
      <td>618479.000000</td>
      <td>618479.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>29.127506</td>
      <td>14.314417</td>
      <td>5.887185</td>
      <td>2015.340026</td>
    </tr>
    <tr>
      <th>std</th>
      <td>87.278642</td>
      <td>4.481804</td>
      <td>3.206358</td>
      <td>1.019771</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2013.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>8.000000</td>
      <td>12.000000</td>
      <td>3.000000</td>
      <td>2014.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>15.000000</td>
      <td>15.000000</td>
      <td>5.000000</td>
      <td>2015.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>28.000000</td>
      <td>17.000000</td>
      <td>9.000000</td>
      <td>2016.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>21296.000000</td>
      <td>23.000000</td>
      <td>12.000000</td>
      <td>2017.000000</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">#check the number of rides in each membership type
membership_summary = trips.groupby([&quot;subscriber_type&quot;])[&quot;subscriber_type&quot;].count().sort_values(ascending=False)
membership_summary
print(sum(membership_summary[:14])/float(sum(membership_summary)))

</code></pre>

<pre><code>0.9870834453623094
</code></pre>

<pre><code class="language-python">#check number of rides on each type of membership by year
frequent_m = membership_summary[:14] 
frequent_m_mask = trips[&quot;subscriber_type&quot;].map(lambda x : x in frequent_m)
freq_m_year = trips[frequent_m_mask].groupby([&quot;subscriber_type&quot;, &quot;year&quot;])[&quot;subscriber_type&quot;].count()
freq_m_year
#some type of memberships have become inactive
</code></pre>

<pre><code>subscriber_type                       year  
24-Hour Kiosk (Austin B-cycle)        2013.0      1296
                                      2014.0    107376
7-Day                                 2014.0       127
                                      2015.0      3005
                                      2016.0         5
7-Day Membership (Austin B-cycle)     2013.0        13
                                      2014.0      2747
Annual Membership (Austin B-cycle)    2013.0        72
                                      2014.0     30234
Explorer                              2014.0        80
                                      2015.0      2456
                                      2016.0      2712
                                      2017.0      2090
Founding Member                       2014.0       366
                                      2015.0      1860
                                      2016.0      1235
                                      2017.0        89
Founding Member (Austin B-cycle)      2013.0        48
                                      2014.0      2716
Local30                               2014.0        18
                                      2015.0     12827
                                      2016.0     12383
                                      2017.0      8200
Local365                              2014.0      2075
                                      2015.0     46117
                                      2016.0     46860
                                      2017.0     23271
Local365 ($80 plus tax)               2016.0      4005
Local365+Guest Pass                   2017.0      1351
Semester Membership (Austin B-cycle)  2014.0      2426
Walk Up                               2014.0      4644
                                      2015.0    111917
                                      2016.0    106599
                                      2017.0     45253
Weekender                             2015.0      4446
                                      2016.0      7968
                                      2017.0      9340
Name: subscriber_type, dtype: int64
</code></pre>

<pre><code class="language-python"># Selected 5 most important and active group of members and check the number of rides by months
active_groups_s = [&quot;Walk Up&quot;, &quot;Weekender&quot;, &quot;Local365&quot;, &quot;Local30&quot;, &quot;Explorer&quot;]
end = datetime.datetime.strptime(&quot;2017&quot;, &quot;%Y&quot;)
start = datetime.datetime.strptime(&quot;2014&quot;, &quot;%Y&quot;)
trips_t_control = trips[(trips[&quot;start_time&quot;] &gt; start) &amp; (trips[&quot;start_time&quot;] &lt; end)]
active_groups_mask = trips_t_control[&quot;subscriber_type&quot;].map(lambda x : x in active_groups_s)

frequent_m_month = trips_t_control[active_groups_mask].groupby([&quot;subscriber_type&quot;, &quot;month&quot;])[&quot;subscriber_type&quot;].count()

frequent_m_month
#most bike trips are taken between March to October
</code></pre>

<pre><code>subscriber_type  month
Explorer         1.0        435
                 2.0        182
                 3.0        882
                 4.0        251
                 5.0        415
                 6.0        522
                 7.0        558
                 8.0        309
                 9.0        351
                 10.0       733
                 11.0       419
                 12.0       191
Local30          1.0       1764
                 2.0        232
                 3.0       3288
                 4.0        932
                 5.0       2017
                 6.0       2374
                 7.0       3466
                 8.0       2907
                 9.0       2399
                 10.0      2912
                 11.0      2056
                 12.0       881
Local365         1.0       9685
                 2.0       2364
                 3.0      11599
                 4.0       3715
                 5.0       7787
                 6.0       8019
                 7.0       8311
                 8.0       8459
                 9.0       9919
                 10.0     11538
                 11.0      7971
                 12.0      5685
Walk Up          1.0      16532
                 2.0      13971
                 3.0      39104
                 4.0      10994
                 5.0      23409
                 6.0      18243
                 7.0      19019
                 8.0      13901
                 9.0      16647
                 10.0     27766
                 11.0     13959
                 12.0      9615
Weekender        1.0        712
                 3.0       1477
                 5.0       1134
                 6.0        901
                 7.0        878
                 8.0        952
                 9.0       1194
                 10.0      3397
                 11.0      1568
                 12.0       201
Name: subscriber_type, dtype: int64
</code></pre>

<pre><code class="language-python"># plot trend by month and by week !
plot (frequent_m_month.loc[&quot;Explorer&quot;], marker='None', linestyle='-', label='Explorer')
plot (frequent_m_month.loc[&quot;Local30&quot;], marker='None', linestyle='-', label='Local30')
plot (frequent_m_month.loc[&quot;Local365&quot;], marker='None', linestyle='-', label='Local365')
plot (frequent_m_month.loc[&quot;Walk Up&quot;], marker='None', linestyle='-', label='Walk Up')
plot (frequent_m_month.loc[&quot;Weekender&quot;], marker='None', linestyle='-', label='Weekender')
xlabel('Month')
ylabel('Number of rides')
legend(loc='best')
show()
</code></pre>

<p><img src="output_20_0.png" alt="png" /></p>

<pre><code class="language-python">#ax2 = ax1.twiny()
#ax2.set_xlabel(&quot;x-transformed&quot;)
#ax2.set_xlim(0, 60)
#ax2.set_xticks([10, 30, 40])
#ax2.set_xticklabels(['7','8','99'])
</code></pre>

<pre><code class="language-python"># observe by the trend in different years
</code></pre>

<pre><code class="language-python">def plot_monthly_trips(start,memberships, ax):
    active_groups_s = memberships
    trips_t_control = trips[trips[&quot;year&quot;] == start]
    active_groups_mask = trips_t_control[&quot;subscriber_type&quot;].map(lambda x : x in active_groups_s)
    frequent_m_month = trips_t_control[active_groups_mask].groupby([&quot;subscriber_type&quot;, &quot;month&quot;])[&quot;subscriber_type&quot;].count()
    for i in memberships:
        ax.plot(frequent_m_month.loc[i], marker='None', linestyle='-', label=i)
        
    ax.set_xlabel(&quot;&quot;.join([str(start),&quot;'s '&quot;,'Months']))
    if start == 2015: 
        ax.set_ylabel('Number of rides')
    #legend(loc='best')
</code></pre>

<pre><code class="language-python">fig, (ax1, ax2, ax3) = subplots(nrows=1,
                                ncols=3,
                                sharex=True,
                                sharey=True,
                                figsize=(16, 6))
in_mem = [&quot;Walk Up&quot;,&quot;Local365&quot;, &quot;Local30&quot;, &quot;Explorer&quot;, &quot;Weekender&quot;]
plot_monthly_trips(start = 2015,  memberships = in_mem, ax = ax1)
plot_monthly_trips(start = 2016,   memberships = in_mem, ax = ax2)
plot_monthly_trips(start = 2017,   memberships = in_mem, ax = ax3)
plt.subplots_adjust(wspace =0.1, hspace =0)
fig.suptitle('Aggregated trips by months per year')
legend(loc='best')
</code></pre>

<pre><code>&lt;matplotlib.legend.Legend at 0xb78ac18&gt;
</code></pre>

<p><img src="output_24_1.png" alt="png" /></p>

<p>We can see a peak in March and October which might be caused by some event! We should take a look at the pricing of walk up membership !!!</p>

<pre><code class="language-python">frequent_m_hour = trips_t_control[active_groups_mask].groupby([&quot;subscriber_type&quot;, &quot;hours&quot;])[&quot;subscriber_type&quot;].count()

#frequent_m_hour[&quot;Local365&quot;]
#frequent_m_hour[&quot;Local30&quot;]
# There are more bike rented by locals among peak hours
#frequent_m_hour[&quot;Weekender&quot;]
#frequent_m_hour[&quot;Walk Up&quot;]
# Bike rented by tourist are more evenly distributed in daytime

plot (frequent_m_hour.loc[&quot;Explorer&quot;], marker='None', linestyle='-', label='Explorer')
plot (frequent_m_hour.loc[&quot;Local30&quot;], marker='None', linestyle='-', label='Local30')
plot (frequent_m_hour.loc[&quot;Local365&quot;], marker='None', linestyle='-', label='Local365')
plot (frequent_m_hour.loc[&quot;Walk Up&quot;], marker='None', linestyle='-', label='Walk Up')
plot (frequent_m_hour.loc[&quot;Weekender&quot;], marker='None', linestyle='-', label='Weekender')
xlabel('Time')
ylabel('Number of rides')
title(&quot;Aggregated trips by hour&quot;)
legend(loc='best')
show()
</code></pre>

<p><img src="output_26_0.png" alt="png" /></p>

<p>We can see peaks in rush hours among local members. While walk up has a interesting high number of trips.</p>

<pre><code class="language-python">def hours_to_category(hours):
    if hours &gt;= 7 and hours &lt;= 9:
        return &quot;rush_m&quot;
    elif hours &gt;= 10 and hours &lt;= 4:
        return &quot;day time&quot;
    elif hours &gt;=5 and hours &lt;= 7:
        return &quot;rush_n&quot;
    else:
        return &quot;others&quot;
</code></pre>

<pre><code class="language-python">trips_t_control[&quot;time_cat&quot;] = trips_t_control[&quot;hours&quot;].map(hours_to_category)

</code></pre>

<pre><code>C:\Users\Akhil\Anaconda2\lib\site-packages\ipykernel_launcher.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</code></pre>

<pre><code class="language-python">stations_close_McCombs = stations[(stations[&quot;latitude&quot;] &lt; 30.30) &amp; (stations[&quot;latitude&quot;] &gt; 30.27) \
                                  &amp; (stations[&quot;longitude&quot;] &lt; -97.6) &amp; (stations[&quot;longitude&quot;] &gt; -97.8)\
                                 &amp; (stations[&quot;status&quot;] == &quot;active&quot;)]
stations_close_McCombs
#stations_close_McCombs.loc[:,[&quot;station_id&quot;, &quot;latitude&quot;, &quot;longitude&quot;]]
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>location</th>
      <th>longitude</th>
      <th>name</th>
      <th>station_id</th>
      <th>status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30.27041</td>
      <td>(30.27041 -97.75046)</td>
      <td>-97.75046</td>
      <td>West &amp; 6th St.</td>
      <td>2537</td>
      <td>active</td>
    </tr>
    <tr>
      <th>9</th>
      <td>30.28576</td>
      <td>(30.28576 -97.74181)</td>
      <td>-97.74181</td>
      <td>UT West Mall @ Guadalupe</td>
      <td>2548</td>
      <td>active</td>
    </tr>
    <tr>
      <th>10</th>
      <td>30.27336</td>
      <td>(30.27336 -97.73805)</td>
      <td>-97.73805</td>
      <td>State Capitol Visitors Garage @ San Jacinto &amp; ...</td>
      <td>2561</td>
      <td>active</td>
    </tr>
    <tr>
      <th>17</th>
      <td>30.27466</td>
      <td>(30.27466 -97.77028)</td>
      <td>-97.77028</td>
      <td>MoPac Pedestrian Bridge @ Veterans Drive</td>
      <td>3377</td>
      <td>active</td>
    </tr>
    <tr>
      <th>21</th>
      <td>30.27217</td>
      <td>(30.27217 -97.75246)</td>
      <td>-97.75246</td>
      <td>Henderson &amp; 9th</td>
      <td>3685</td>
      <td>active</td>
    </tr>
    <tr>
      <th>31</th>
      <td>30.27193</td>
      <td>(30.27193 -97.73854)</td>
      <td>-97.73854</td>
      <td>11th &amp; San Jacinto</td>
      <td>3291</td>
      <td>active</td>
    </tr>
    <tr>
      <th>38</th>
      <td>30.27186</td>
      <td>(30.27186 -97.73997)</td>
      <td>-97.73997</td>
      <td>OFFICE/Main/Shop/Repair</td>
      <td>1001</td>
      <td>active</td>
    </tr>
    <tr>
      <th>53</th>
      <td>30.27260</td>
      <td>(30.2726 -97.74127)</td>
      <td>-97.74127</td>
      <td>Capitol Station / Congress &amp; 11th</td>
      <td>2497</td>
      <td>active</td>
    </tr>
    <tr>
      <th>56</th>
      <td>30.28118</td>
      <td>(30.28118 -97.75219)</td>
      <td>-97.75219</td>
      <td>Pease Park</td>
      <td>3464</td>
      <td>active</td>
    </tr>
    <tr>
      <th>57</th>
      <td>30.28039</td>
      <td>(30.28039 -97.73809)</td>
      <td>-97.73809</td>
      <td>Bullock Museum @ Congress &amp; MLK</td>
      <td>2538</td>
      <td>active</td>
    </tr>
    <tr>
      <th>58</th>
      <td>30.27974</td>
      <td>(30.27974 -97.74254)</td>
      <td>-97.74254</td>
      <td>17th &amp; Guadalupe</td>
      <td>2540</td>
      <td>active</td>
    </tr>
    <tr>
      <th>64</th>
      <td>30.27616</td>
      <td>(30.27616 -97.74488)</td>
      <td>-97.74488</td>
      <td>13th &amp; San Antonio</td>
      <td>3635</td>
      <td>active</td>
    </tr>
    <tr>
      <th>71</th>
      <td>30.27654</td>
      <td>(30.27654 -97.74155)</td>
      <td>-97.74155</td>
      <td>State Capitol @ 14th &amp; Colorado</td>
      <td>2541</td>
      <td>active</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">borrow_heatmap_df = trips_t_control[[&quot;start_station_id&quot;,&quot;time_cat&quot;]].merge(stations_close_McCombs[[&quot;station_id&quot;, &quot;latitude&quot;, &quot;longitude&quot;,&quot;location&quot;]],
                                                                           left_on = &quot;start_station_id&quot;,
                                                                          right_on = &quot;station_id&quot;)
borrow_heatmap_df[:5]
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>start_station_id</th>
      <th>time_cat</th>
      <th>station_id</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2538.0</td>
      <td>others</td>
      <td>2538</td>
      <td>30.28039</td>
      <td>-97.73809</td>
      <td>(30.28039 -97.73809)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2538.0</td>
      <td>others</td>
      <td>2538</td>
      <td>30.28039</td>
      <td>-97.73809</td>
      <td>(30.28039 -97.73809)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2538.0</td>
      <td>others</td>
      <td>2538</td>
      <td>30.28039</td>
      <td>-97.73809</td>
      <td>(30.28039 -97.73809)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2538.0</td>
      <td>others</td>
      <td>2538</td>
      <td>30.28039</td>
      <td>-97.73809</td>
      <td>(30.28039 -97.73809)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2538.0</td>
      <td>others</td>
      <td>2538</td>
      <td>30.28039</td>
      <td>-97.73809</td>
      <td>(30.28039 -97.73809)</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">rush_m_heatmap_df = borrow_heatmap_df[borrow_heatmap_df[&quot;time_cat&quot;] == &quot;rush_m&quot;]
rush_m_heatmap_weight = borrow_heatmap_df.groupby([&quot;latitude&quot;, &quot;longitude&quot;])[&quot;location&quot;].count()
rush_m_station_lat , rush_m_station_lon = zip(*rush_m_heatmap_weight.index.values) 
rush_m_heatmap_weight.values
#rush_m_heatmap_weight_p = rush_m_heatmap_weight.values/ float(sum(rush_m_heatmap_weight.values))
</code></pre>

<pre><code>array([10186,  2087, 16805,  3944,  5110,  4135,  6352,  9145,   334,
        9115], dtype=int64)
</code></pre>

<pre><code class="language-python">rush_m_heatmap_weight_p = rush_m_heatmap_weight.values/ float(sum(rush_m_heatmap_weight.values))
rush_m_heatmap_weight_p
</code></pre>

<pre><code>array([0.15154806, 0.03105054, 0.25002604, 0.05867912, 0.07602696,
       0.06152084, 0.09450553, 0.13605999, 0.00496928, 0.13561365])
</code></pre>

<pre><code class="language-python">gmap = gmplot.GoogleMapPlotter(30.28398,-97.73792, 13)


#gmap.heatmap(rush_m_heatmap_df[&quot;latitude&quot;] ,rush_m_heatmap_df[&quot;longitude&quot;], threshold=10, radius = 35)
for i in range(0, len(rush_m_station_lat)):
    gmap.heatmap([rush_m_station_lat[i]], [rush_m_station_lon[i]], radius = rush_m_heatmap_weight_p[i] * 300)
    lat = [rush_m_station_lat[i]]
    lon = [rush_m_station_lon[i]]
    gmap.marker(30.2726,-97.74127, 'cornflowerblue')
# Draw
#gmap.draw(&quot;rush_morning.html&quot;)
gmap.draw(&quot;rush_morning_w.html&quot;)
</code></pre>

<pre><code class="language-python">!pip install mapsplotlib
</code></pre>

<pre><code>Collecting mapsplotlib
  Downloading https://files.pythonhosted.org/packages/58/67/a321ad8a1519d9b3665c8e93d71cb2fd22036bf81ddeab7624999186738c/mapsplotlib-1.1.2.tar.gz
Requirement already satisfied: numpy&gt;=1.8.2 in c:\users\akhil\anaconda2\lib\site-packages (from mapsplotlib) (1.14.3)
Requirement already satisfied: pandas&gt;=0.13.1 in c:\users\akhil\anaconda2\lib\site-packages (from mapsplotlib) (0.23.0)
Requirement already satisfied: scipy&gt;=0.13.3 in c:\users\akhil\anaconda2\lib\site-packages (from mapsplotlib) (1.1.0)
Requirement already satisfied: matplotlib&gt;=1.3.1 in c:\users\akhil\anaconda2\lib\site-packages (from mapsplotlib) (2.2.2)
Requirement already satisfied: requests&gt;=2.18.4 in c:\users\akhil\anaconda2\lib\site-packages (from mapsplotlib) (2.18.4)
Requirement already satisfied: pillow&gt;=4.3.0 in c:\users\akhil\anaconda2\lib\site-packages (from mapsplotlib) (5.1.0)
Requirement already satisfied: pytz&gt;=2011k in c:\users\akhil\anaconda2\lib\site-packages (from pandas&gt;=0.13.1-&gt;mapsplotlib) (2013b0)
Requirement already satisfied: python-dateutil&gt;=2.5.0 in c:\users\akhil\anaconda2\lib\site-packages (from pandas&gt;=0.13.1-&gt;mapsplotlib) (2.7.3)
Requirement already satisfied: cycler&gt;=0.10 in c:\users\akhil\anaconda2\lib\site-packages (from matplotlib&gt;=1.3.1-&gt;mapsplotlib) (0.10.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in c:\users\akhil\anaconda2\lib\site-packages (from matplotlib&gt;=1.3.1-&gt;mapsplotlib) (2.2.0)
Requirement already satisfied: six&gt;=1.10 in c:\users\akhil\anaconda2\lib\site-packages (from matplotlib&gt;=1.3.1-&gt;mapsplotlib) (1.11.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in c:\users\akhil\anaconda2\lib\site-packages (from matplotlib&gt;=1.3.1-&gt;mapsplotlib) (1.0.1)
Requirement already satisfied: backports.functools_lru_cache in c:\users\akhil\anaconda2\lib\site-packages (from matplotlib&gt;=1.3.1-&gt;mapsplotlib) (1.5)
Requirement already satisfied: chardet&lt;3.1.0,&gt;=3.0.2 in c:\users\akhil\anaconda2\lib\site-packages (from requests&gt;=2.18.4-&gt;mapsplotlib) (3.0.4)
Requirement already satisfied: idna&lt;2.7,&gt;=2.5 in c:\users\akhil\anaconda2\lib\site-packages (from requests&gt;=2.18.4-&gt;mapsplotlib) (2.6)
Requirement already satisfied: urllib3&lt;1.23,&gt;=1.21.1 in c:\users\akhil\anaconda2\lib\site-packages (from requests&gt;=2.18.4-&gt;mapsplotlib) (1.22)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\akhil\anaconda2\lib\site-packages (from requests&gt;=2.18.4-&gt;mapsplotlib) (2018.4.16)
Requirement already satisfied: setuptools in c:\users\akhil\anaconda2\lib\site-packages (from kiwisolver&gt;=1.0.1-&gt;matplotlib&gt;=1.3.1-&gt;mapsplotlib) (39.1.0)
Building wheels for collected packages: mapsplotlib
  Running setup.py bdist_wheel for mapsplotlib: started
  Running setup.py bdist_wheel for mapsplotlib: finished with status 'done'
  Stored in directory: C:\Users\Akhil\AppData\Local\pip\Cache\wheels\93\42\c1\88411f7fd6c0dab09732118e2a946508b2a74a93afc6a77321
Successfully built mapsplotlib
Installing collected packages: mapsplotlib
Successfully installed mapsplotlib-1.1.2


distributed 1.21.8 requires msgpack, which is not installed.
grin 1.2.1 requires argparse&gt;=1.1, which is not installed.
You are using pip version 10.0.1, however version 18.0 is available.
You should consider upgrading via the 'python -m pip install --upgrade pip' command.
</code></pre>

<pre><code class="language-python">from mapsplotlib import mapsplot as mplt

</code></pre>

<pre><code class="language-python">df = rush_m_heatmap_df[['latitude','longitude']].drop_duplicates()
color = ['green','red','blue','green','red','blue','green','red','blue','blue']
size = ['mid','mid','mid','mid','mid','tiny','tiny','mid','mid','mid']

</code></pre>

<pre><code class="language-python">df['value'] = [1,0.2,0.3,0.4,0.2,0.3,0.4,0.5,0.6,0.4]
</code></pre>

<pre><code class="language-python"># df['color'] = color
# df['size'] = size
# df['label'] = ['+50%','%20','sorry','A','A','A','A','A','A','A']
# df['label'] = rush_m_heatmap_weight_p
# df['label'] = df['label'].apply(lambda x: str(x))
df
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>47</th>
      <td>30.28039</td>
      <td>-97.73809</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9153</th>
      <td>30.27260</td>
      <td>-97.74127</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>25962</th>
      <td>30.27974</td>
      <td>-97.74254</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>32313</th>
      <td>30.28576</td>
      <td>-97.74181</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>41431</th>
      <td>30.27336</td>
      <td>-97.73805</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>45375</th>
      <td>30.27466</td>
      <td>-97.77028</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>50523</th>
      <td>30.27041</td>
      <td>-97.75046</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>60659</th>
      <td>30.27193</td>
      <td>-97.73854</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>62746</th>
      <td>30.27654</td>
      <td>-97.74155</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>66880</th>
      <td>30.28118</td>
      <td>-97.75219</td>
      <td>0.4</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">mplt.plot_markers(df)

</code></pre>

<p><img src="output_40_0.png" alt="png" /></p>

<pre><code class="language-python">datetime.datetime.strptime(trips[&quot;start_time&quot;][0], &quot;%Y-%m-%d %H:%M:%S&quot;)
</code></pre>

<pre><code>datetime.datetime(2015, 3, 19, 19, 12)
</code></pre>

<pre><code class="language-python">datetime.datetime.strptime(&quot;2017&quot;, &quot;%Y&quot;)
</code></pre>

<pre><code>datetime.datetime(2017, 1, 1, 0, 0)
</code></pre>

    </div>

    


    
    

    

    


  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

